@startuml
title Add Command Activity Diagram

start

:User enters add command;
:Trim and tokenize arguments;

if () then ([invalid format])
  :Display "Invalid command format";
  stop
else ([format ok])
  if () then ([required fields missing])
    :Display "Missing required field(s): name, phone, email, or company";
    stop
  else ([all required present])
    :Validate field values (name, phone, email, company, tags);
    if () then ([invalid values])
      :Display "Invalid field value(s): check name, phone, email, company, or tags";
      stop
    else ([values valid])
      :Create Person object;
      :Check duplicate by name + phone;
      if () then ([duplicate person])
        :Display "This person already exists in the contact book";
        stop
      else ([unique person])
        :Check duplicate email;
        if () then ([duplicate email])
          :Display "This email already exists in the contact book";
          stop
        else ([unique email])
          :Add new person to Model;
          :Save updated AddressBook to Storage;
          :Display "You have successfully added the contact";
          stop
        endif
      endif
    endif
  endif
endif

stop
@enduml
